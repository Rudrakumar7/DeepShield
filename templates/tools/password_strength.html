{% extends 'base.html' %}

{% block content %}
<div class="row justify-content-center fade-in">
    <div class="col-md-8 text-center">
        <h2 class="mb-4">üí™ Password Strength Checker</h2>
        <div class="glass p-4" style="max-width: 600px; margin: 0 auto;">
            <p>Enter a password to analyze its strength and get improvement tips.</p>

            <div class="form-group mb-4">
                <input type="text" class="form-control text-center" id="passwordInput"
                    placeholder="Enter password to check..." style="font-size: 1.2rem;" oninput="checkStrength()">
            </div>

            <div class="progress mb-3" style="height: 10px;">
                <div id="strengthBar" class="progress-bar" role="progressbar"
                    style="width: 0%; transition: width 0.5s ease;"></div>
            </div>
            <h4 id="strengthLabel" class="mb-3">Strength: -</h4>

            <div id="feedbackBox" class="text-left mt-3 p-3"
                style="background: rgba(0,0,0,0.2); border-radius: 8px; display: none;">
                <h5>Suggestions:</h5>
                <ul id="feedbackList" class="pl-3 mb-0"></ul>
            </div>

            <div class="mt-4 text-center">
                <a href="{{ url_for('tools') }}" class="text-secondary">‚Üê Back to Tools</a>
            </div>
        </div>
    </div>
</div>

<script>
    async function checkStrength() {
        const password = document.getElementById('passwordInput').value;
        const feedbackBox = document.getElementById('feedbackBox');
        const feedbackList = document.getElementById('feedbackList');
        const strengthBar = document.getElementById('strengthBar');
        const strengthLabel = document.getElementById('strengthLabel');

        if (!password) {
            strengthBar.style.width = '0%';
            strengthLabel.innerText = "Strength: -";
            feedbackBox.style.display = 'none';
            return;
        }

        try {
            const response = await fetch('/tools/password-strength', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ password })
            });

            const data = await response.json();

            // Update Bar
            strengthBar.style.width = data.score + '%';

            // Update Color
            if (data.score < 40) strengthBar.className = "progress-bar bg-danger";
            else if (data.score < 70) strengthBar.className = "progress-bar bg-warning";
            else if (data.score < 90) strengthBar.className = "progress-bar bg-info";
            else strengthBar.className = "progress-bar bg-success";

            // Update Label
            strengthLabel.innerText = "Strength: " + data.strength;

            // Update Feedback
            feedbackList.innerHTML = "";
            if (data.feedback && data.feedback.length > 0) {
                data.feedback.forEach(item => {
                    const li = document.createElement('li');
                    li.innerText = item;
                    feedbackList.appendChild(li);
                });
                feedbackBox.style.display = 'block';
            } else {
                feedbackBox.style.display = 'none';
            }

        } catch (error) {
            console.error("Error checking strength:", error);
        }
    }
</script>
{% endblock %}